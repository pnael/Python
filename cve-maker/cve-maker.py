#!/usr/bin/env python3

__description__ = 'Tool to detect, find, compile and execute a CVE on the current or a remote machine.'
__author__ = 'msd0pe'
__version__ = '2.0'
__date__ = '2019/09/17'

"""
https://github.com/msd0pe-1
Source code put in public domain by msd0pe, no Copyright
Any malicious or illegal activity may be punishable by law
Use at your own risk
"""

"""
CHANGELOG:
	2019/09/14 : V2.0 - Remote exploitation is now possible.
	2019/08/03 : V1.3.2 - Upgrading to Python 3.7, optimizing Detect option & detecting payloads langages.
	2019/07/05 : V1.3.1 - Optimization of the Search and Detect options.
	2019/06/28 : V1.3 - Adding the Searching option.
	2019/06/28 : V1.2 - Adding the EDB Check option.
	2019/06/25 : V1.1 - Adding the Detection option.
	2019/06/23 : V1.0 - Project Start.
"""

class bcolors:
    PURPLE = '\033[95m'
    BLUE = '\033[94m'
    GREEN = '\033[92m'
    OCRA = '\033[93m'
    RED = '\033[91m'
    CYAN = '\033[96m'
    ENDC = '\033[0m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'


try:
    import optparse
    from functions import info as info
    from functions import detect as detect
    from functions import remote as remote
    from functions import payloads as payloads

except ImportError:
    print(bcolors.RED + bcolors.BOLD + "\nError. Have you installed the requirements properly?" + bcolors.ENDC + bcolors.ENDC)
    print(bcolors.RED + bcolors.BOLD + "Be sure to run the script as follows:\n" + bcolors.ENDC + bcolors.ENDC)
    print(bcolors.OCRA + bcolors.BOLD + "python3 cve-maker.py ...." + bcolors.ENDC + bcolors.ENDC)
    print(bcolors.OCRA + bcolors.BOLD + "./cve-maker.py ...." + bcolors.ENDC + bcolors.ENDC)

def Main():
    Menu = optparse.OptionParser(usage='python %prog [options] site', version='%prog ' + __version__)
    Menu.add_option('-d', '--detect', action="store_true", dest="detect", help='detect vulnerabilities on the current machine')
    Menu.add_option('-i', '--check', action="store_true", dest="check", help='check if the edb-id is verified')
    Menu.add_option('-r', '--remote', action="store_true", dest="remote", help='attack a target remotely')
    Menu.add_option('-f', '--find', type="str", dest="find", help='looking for an exploit by its vulnerable software')
    Menu.add_option('-c', '--cve', type="str", dest="cve", help='looks for the CVE from its name')
    Menu.add_option('-e', '--edb', type="str", dest="edb", help='looks for the CVE from its EDB-ID')
    Menu.add_option('-g', '--gcc', type="str", dest="gcc", help='add options to compilation')
    Menu.add_option('-l', '--lang', type="str", dest="lang", help='langage of the exploit. [Default: c]')
    (options, args) = Menu.parse_args()

    Sites = optparse.OptionGroup(Menu, "Available 0day sites", "exploit_db\n")
    Menu.add_option_group(Sites)

    Langages = optparse.OptionGroup(Menu, "Langages", "sh\n ruby\n perl\n python\n php\n c++\n c\n")
    Menu.add_option_group(Langages)

    Examples = optparse.OptionGroup(Menu, "Examples", 'python cve-maker -e 12345 -l ruby exploit_db                          python cve-maker -c 2019-98765 -g "-lpthread" exploit_db')
    Menu.add_option_group(Examples) 

    sites = {"exploit_db"}
     
    if len(args) != 1:
        Menu.print_help()
        print('')
        print('  %s' % __description__)
        print('  Source code put in public domain by ' + bcolors.PURPLE + bcolors.BOLD + 'msd0pe' + bcolors.ENDC + bcolors.ENDC + ',' + bcolors.RED + bcolors.BOLD + 'no Copyright' + bcolors.ENDC + bcolors.ENDC)
        print('  Any malicious or illegal activity may be punishable by law')
        print('  Use at your own risk')

    elif len(args) == 1:
        site = args[0]
        if site in sites:
            try:
                if options.remote == True:
                    detect.SearchExploit(options.find, options.check)
                    payloads.CreateDirectory()
                    payloads.FindCVE(site, options.cve, options.edb)
                    payloads.WritePayload(payloads.payload, payloads.name, options.lang)
                    remote.Menu(options.remote, payloads.payload, payloads.name, options.lang, payloads.name)

                else:
                    detect.SearchExploit(options.find, options.check)
                    detect.DetectCVE(site, options.detect, options.check)
                    payloads.CreateDirectory()
                    payloads.FindCVE(site, options.cve, options.edb)
                    payloads.WritePayload(payloads.payload, payloads.name, options.lang)
                    payloads.Compilation(payloads.name, options.gcc, options.lang)
                    payloads.Execute(payloads.name, options.lang)

            except NameError:
                if options.cve == None and options.edb == None and options.detect == None and options.check == None and options.find == None and options.remote == None:
                    print(bcolors.RED + bcolors.BOLD + "\nYou must specify a CVE-NAME or a EDB-ID !\n" + bcolors.ENDC + bcolors.ENDC)
                elif options.check == True and options.detect == None and options.find == None:
                    print(bcolors.RED + bcolors.BOLD + "\nDon't forget the '-d' or '-f' option !\n" + bcolors.ENDC + bcolors.ENDC)
                elif options.remote == True and options.cve == None and options.edb == None and options.lang == None:
                    print(bcolors.RED + bcolors.BOLD + "\nDon't forget the '-e', '-l' or '-c' option for the remote machine !\n" + bcolors.ENDC + bcolors.ENDC)
                else:
                     pass

            except AttributeError:
                if options.remote == True and options.find != None:
                    print(bcolors.RED + bcolors.BOLD + "\nThe remote option couldn't be use with the find option !\n" + bcolors.ENDC + bcolors.ENDC)

        else:
            Menu.print_help()
            print('')
            print('  %s' % __description__)
            print('  Source code put in public domain by ' + bcolors.PURPLE + bcolors.BOLD + 'msd0pe' + bcolors.ENDC + bcolors.ENDC + ',' + bcolors.RED + bcolors.BOLD + 'no Copyright' + bcolors.ENDC + bcolors.ENDC)
            print('  Any malicious or illegal activity may be punishable by law')
            print('  Use at your own risk')

if __name__ == '__main__':
    Main()
